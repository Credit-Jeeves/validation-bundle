{% form_theme paymentType 'RjCoreBundle::form.html.twig' %}
{% form_theme userDetailsType 'RjCoreBundle::form.html.twig' %}


<div id="pay-popup" class="pricing-popup dashboard-popup properties-popup payments-popup verify-min">
    <h1>{{ 'pay_popup.title' | trans }}</h1>
    <div class="clearfix col-box attention-container">

        <ul class="steps clearfix">
            <li class="step1" data-bind="css: { 'active': 'details' == step() }">
                <span class="step"><span>{{ 'pay_popup.step.1' | trans }}</span></span>
            </li>
            <li class="step2" data-bind="css: { 'active': 'source' == step() }">
                <span class="step"><span>{{ 'pay_popup.step.2' | trans }}</span></span>
            </li>
            <li class="step3"
                data-bind="css: {'active': 'user' == step() || 'questions' == step() }, visible: stepExist('questions')">
                <span class="step"><span>{{ 'pay_popup.step.3' | trans }}</span></span>
            </li>
            <li class="step4" data-bind="css: { 'active': 'pay' == step() }">
                <span class="step"><span>{{ 'pay_popup.step.4' | trans }}</span></span>
            </li>
        </ul>

        <div class="attention-box pie-el" style="display: none">
            <h3>{{ 'pay_popup.errors.title' | trans }}</h3>
            <ul class="default">
            </ul>
        </div>

        <div class="col" data-bind="visible: 'details' == step()">
            <div class="form-row clearfix">
                <label>{{ 'checkout.property' | trans }}<b>*</b></label>
                <div class="fields-box" id="rentjeeves_checkoutbundle_paymenttype_property_address">
                    <span class="value big left" data-bind="text: propertyAddress"></span>
                    <small><b>*</b>{{ 'required' | trans }}</small>
                </div>
            </div>
            <form {{ form_enctype(paymentType) }} novalidate method="post">
                {{ form_widget(paymentType) }}
                {{ JSFV(paymentType) }}

            </form>
        </div>

        <div class="col long-label" data-bind="visible: 'source' == step()" id="id-source-step">
            <div class="form-row clearfix">
                <div class="fields-box">
                    <!-- ko foreach: paymentAccounts -->
                        <label class="checkbox radio" style="clear: left;">
                            <input type="radio"
                                required="required"
                                data-bind="
                                    checked: $parent.paymentAccountId,
                                    value: $data.id
                                " />
                            <i></i>
                            <span data-bind="text: $data.name"></span>
                        </label>
                    <!-- /ko -->
                    <div class="fields-box" data-bind="visible: !isNewPaymentAccount()">
                        <a href="#" data-bind="click: addNewPaymentAccount">{{ 'common.add_new' | trans }}</a>
                    </div>
                </div>
            </div>
            <div data-bind="visible: isNewPaymentAccount">
                {{ render(controller('RjCheckoutBundle:Component:source')) }}
            </div>
        </div>

        <div class="col" data-bind="visible: 'user' == step()">
            <div class="form-row clearfix">
                <div class="fields-box">
                    <small><b>*</b>{{ 'required' | trans }}</small>
                </div>
            </div>
            <form {{ form_enctype(userDetailsType) }} method="post" novalidate>
                {{ form_widget(userDetailsType) }}
                {{ JSFV(userDetailsType) }}
            </form>
        </div>

        <div class="col long-label" data-bind="visible: 'questions' == step()">

            <div class="scroll-box" style="padding-top: 0;">
                <div id="vi-questions" class="scroll" style="padding-top: 0;">
                    <div class="vi-questions-content"
                         data-bind="html: questions"
                         style="width:300px; height:235px; overflow-y:scroll; padding-top: 10px;"
                    >
                    </div>
                </div>
                <div class="tooltip-box type3 pie-el">
                    <p class="verify">
                        {{ 'checkout.questions.tooltip.line1' | trans }}
                    </p>
                    <p class="verify">
                        {{ 'checkout.questions.tooltip.line2' | trans }}
                    </p>
                </div>
            </div>
            {{ JSFV(questionsType) }}
        </div>

        <div data-bind="visible: 'pay' == step()">
            <h3 class="italic">
                <span data-bind="visible: 'recurring' == type()">{{ 'checkout.recurring_for' | trans }}</span>
                <span data-bind="text: propertyAddress"></span>
            </h3>

            <div class="information-box pie-el"
                 data-bind="visible: 'one_time' == type(), i18n: {'DAY': startMonth, 'YEAR': startYear}"
            >
                checkout.one_time_payment.note
            </div>

            <div class="clearfix halfs-box">
                <div class="half-box left">
                    <h4>{{ 'checkout.who_paid' | trans }}</h4>
                    <div class="form-row clearfix">
                        <label>{{ 'checkout.send_to' | trans }}</label>
                        <div class="fields-box">
                            <span class="value" data-bind="text: fullPayTo"></span>
                        </div>
                    </div>
                    <div class="form-row clearfix">
                        <label>{{ 'checkout.rent_amount' | trans }}</label>
                        <div class="fields-box">
                            <span class="value" data-bind="text: getAmount"></span>
                        </div>
                    </div>
                    <div class="form-row clearfix" data-bind="visible: 'immediate' != type()">
                        <label>{{ 'checkout.starts_on' | trans }}</label>
                        <div class="fields-box">
                            <span class="value" data-bind="text: startDate"></span>
                        </div>
                    </div>
                    <div class="form-row clearfix" data-bind="visible: 'recurring' == type()">
                        <label>{{ 'checkout.recurs_on' | trans }}</label>
                        <div class="fields-box">
                            <span class="value"
                                  data-bind="text: 'checkout.day.' + frequency() +'.each_month-%DAY%', i18n: {'DAY': dueDate}"></span>
                        </div>
                    </div>
                    <div class="form-row clearfix" data-bind="visible: 'on' == ends()">
                        <label>{{ 'checkout.last_payment_on' | trans }}</label>
                        <div class="fields-box">
                            <span class="value" data-bind="text: getLastPaymentDay"></span>
                        </div>
                    </div>
                </div>
                <div class="half-box right">
                    <h4>{{ 'checkout.how_paying' | trans }}</h4>
                    <div class="form-row clearfix">
                        <label>{{ 'checkout.method' | trans }}</label>
                        <div class="fields-box">
                            <span class="value"
                                  data-bind="text: 'checkout.' + paymentSource.type(), i18n: {}"
                                  id="checkout-payment-source"
                            >

                            </span>
                        </div>
                    </div>
                    <div data-bind="visible: !newPaymentAccount()">
                        <div class="form-row clearfix">
                            <label>{{ 'checkout.account_nickname' | trans }}</label>
                            <div class="fields-box">
                                <span class="value" data-bind="text: paymentSource.name"></span>
                            </div>
                        </div>
                    </div>
                    <div data-bind="visible: 'bank' == paymentSource.type() && newPaymentAccount()">
                        <div class="form-row clearfix">
                            <label>{{ 'checkout.payor_name' | trans }}</label>
                            <div class="fields-box">
                                <span class="value" data-bind="text: paymentSource.PayorName"></span>
                            </div>
                        </div>
                        <div class="form-row clearfix">
                            <label>{{ 'checkout.routing_number' | trans }}</label>
                            <div class="fields-box">
                                <span class="value" data-bind="text: paymentSource.RoutingNumber"></span>
                            </div>
                        </div>
                        <div class="form-row clearfix">
                            <label>{{ 'checkout.account_number' | trans }}</label>
                            <div class="fields-box">
                                <span class="value" data-bind="text: paymentSource.AccountNumber"></span>
                            </div>
                        </div>
                        <div class="form-row clearfix">
                            <label>{{ 'checkout.account_type' | trans }}</label>
                            <div class="fields-box">
                                <span class="value" data-bind="visible: 'Checking' == paymentSource.ACHDepositType()">
                                    {{ 'checkout.account_type.checking' | trans }}
                                </span>
                                <span class="value" data-bind="visible: 'Savings' == paymentSource.ACHDepositType()">
                                    {{ 'checkout.account_type.savings' | trans }}
                                </span>
                                <span class="value" data-bind="visible: 'Unassigned' == paymentSource.ACHDepositType()">
                                    {{ 'checkout.account_type.business_checking' | trans }}
                                </span>
                            </div>
                        </div>
                    </div>
                    <div data-bind="visible: 'card' == paymentSource.type()">
                        <div class="form-row clearfix" data-bind="visible: newPaymentAccount()">
                            <label>{{ 'checkout.card_number' | trans }}</label>
                            <div class="fields-box">
                                <span class="value" data-bind="text: paymentSource.getCardNumber"></span>
                            </div>
                        </div>
                        <div class="form-row clearfix">
                            <label>{{ 'checkout.expiration' | trans }}</label>
                            <div class="fields-box">
                                <span class="value" data-bind="text: paymentSource.ExpirationMonth() + '/' + paymentSource.ExpirationYear()"></span>
                            </div>
                        </div>
                        <div class="form-row clearfix">
                            <label>{{ 'common.address' | trans }}</label>
                            <div class="fields-box">
                                <span class="value" data-bind="text: paymentSource.address.current()"></span>
                            </div>
                        </div>
                    </div>
                    <div class="form-row clearfix">
                        <label>{{ 'checkout.fee' | trans }}</label>
                        <div class="fields-box">
                            <span class="value" data-bind="visible: 'bank' == paymentSource.type()">
                                {{ 'checkout.free' | trans }}
                            </span>
                            <span class="value" data-bind="visible: 'card' == paymentSource.type()">
                                {{ payment_card_fee }}
                            </span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="form-row checkboxes alone clearfix">
                <label class="checkbox">
                    <input type="checkbox" checked="checked">
                    <i> </i>
                    <span class="big">
                        {{ 'checkout.track_score-%AMOUNT%' | trans({'%AMOUNT%': tenant_payment_per_month }) }}
                    </span>
                </label>
                <i class="help after-checkbox pie-el tooltip-link"
                   title="{{ 'checkout.track_score-%AMOUNT%.help' | trans({'%AMOUNT%': tenant_payment_per_month}) }}"
                >
                    ?
                </i>
            </div>
        </div>
    </div>
    <div class="footer-button-box">
        <button class="button grey fixed" data-bind="visible: 'details' != step(), click: previous">
            <span>{{ 'pay_popup.step.previous' | trans }}</span>
        </button>
        <button class="button fixed" data-bind="visible: 'pay' != step(), click: next">
            <span>{{ 'pay_popup.step.next' | trans }}</span>
        </button>
        <button class="button" data-bind="visible: 'pay' == step(), click: next">
            <span>{{ 'checkout.make_payment' | trans }}</span>
        </button>
        {{ include('RjCoreBundle::nortonSecured.html.twig') }}
    </div>
</div>
