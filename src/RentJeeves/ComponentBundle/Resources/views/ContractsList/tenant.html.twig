<!-- Popup Delete Contract -->
{#<div id="contract-delete" class="pricing-popup dashboard-popup properties-popup">
    <h1>{{ 'contract.delete' | trans() }}</h1>
    <div class="clearfix col-box">
        <div class="col" id="contract-address"></div>
        <div class="footer-button-box">
            <button id="button-contract-delete" class="button buttonFix">
                <span>{{ 'delete' | trans() }}</span>
            </button>
            <button id="button-cancel" class="button grey buttonFix">
                <span>{{ 'cancel' | trans() }}</span>
            </button>
        </div>
    </div>
</div>#}
<!-- end Delete Contract -->
<!-- Loader -->
{#<div id="contract-loader" class="pricing-popup dashboard-popup properties-popup">
    <div class="clearfix col-box popup-loader">
        <center>
            <img src="{{ asset('/bundles/core/images/img_loading.gif') }}" alt="Loading" />
        </center>
    </div>
</div>#}
<!-- endloader -->
<div class="pod-large pod-border pod-padding shadow" id="current-payments">
    <h1>{{ 'current_contracts.title' | trans() }}</h1>
    <div class="addPropertyContainer">
        <center>
            <a href="{{ path('property_add')}}" class="button small">
                <span>{{ 'add.property' | trans() }}</span>
            </a>
        </center>
    </div>
    <div class="row-20"></div>
    <div class="properties-table-block table-wrap">
        <div class="table-margin">
            <table class="properties-table zebra-grid contracts-table">
                <thead>
                    <tr class="contracts">
                        <th class="font-helvetica" style="width: 50px">{{ 'contract.rent_amount' | trans() }}</th>
                        <th class="font-helvetica" style="width: 75px">{{ 'contract.payment.next' | trans() }}</th>
                        <th class="font-helvetica" style="width: 350px">{{ 'contract.property' | trans() }}</th>
                        <th class="font-helvetica" style="width: 100px">{{ 'contract.status' | trans() }}</th>
                        <th style="width: 150px;"></th>
                    </tr>
                </thead>
                <tbody>
                {% for contract in contracts %}
                    <tr class="contracts">
                        <td class="font-helvetica">{{ contract.rent }}</td>
                        <td class="font-helvetica">{{ contract.payment_next }}</td>
                        <td class="font-helvetica">{{ contract.full_address }}</td>
                        <td class="font-helvetica">
                            {% if contract.status == 'pending' %}
                                {{ 'contract.status.pending.text' | trans }}
                            {% elseif contract.payment_status == 'processing' %}
                                {{ 'contract.status.processing.text' | trans }}
                            {% elseif contract.status == 'invite' %}
                                {{ 'contract.status.invite.text' | trans }}
                            {% elseif contract.payment_type == 'recurring' %}
                                {{ 'contract.status.recurring.text' | trans({'%payment_date%': contract.payment_due_date}) }}
                            {% elseif contract.payment_type == 'one_time' %}
                                {{ 'contract.status.one_time.text' | trans({'%payment_date%': contract.payment_due_date}) }}
                            {% elseif contract.status == 'approved' %}
                                {{ 'contract.status.approved.text' | trans }}
                            {% elseif contract.status == 'current' %}
                                {{ 'contract.status.current.text' | trans }}
                            {% elseif contract.status == 'finished' %}
                                {{ 'contract.status.finished.text' | trans }}
                            {% else %}
                                {{ contract.status | upper }}
                            {% endif %}
                        </td>

                        <td class="font-helvetica">
                            {% if contract.isPayment %}
                                {% set buttonText = 'contract.edit' | trans() %}
                            {% else %}
                                {% set buttonText = 'contract.pay' | trans() %}
                            {% endif %}

                            {% if contract.status == 'pending' %}
                                <div>
                                    <button class="button small button-contract-pay floatleft" disabled>
                                        <span>{{ 'contract.pay' | trans() }}</span>
                                    </button>
                                    {#<div id="contract-{{ contract.id }}" class="contract-delete floatleft">
                                        <input type="hidden" value="{{ contract.full_address }}">
                                    </div>#}
                                </div>
                            {% elseif contract.status == 'approved' or contract.status == 'invite' %}
                                <div>
                                    <button class="button small button-contract-pay floatleft"
                                            data-bind="click: openPayPopup.bind($data, {{ contract.id }})"
                                            id="contract-pay-{{ loop.revindex }}"
                                            {% if contract.payment_status == 'processing' %} disabled{% endif %}
                                    >

                                        <span>{{ buttonText }}</span>
                                    </button>
                                    {#<div id="contract-{{ contract.id }}" class="contract-delete floatleft">
                                        <input type="hidden" value="{{ contract.full_address }}">
                                    </div>#}
                                </div>
                            {% elseif contract.status == 'current' %}
                                <div>
                                    <button class="button small button-contract-pay floatleft"
                                            data-bind="click: openPayPopup.bind($data, {{ contract.id }})"
                                            id="contract-pay-{{ loop.revindex }}"
                                            {% if contract.payment_status == 'processing' %} disabled{% endif %}
                                            >
                                        <span>{{ buttonText }}</span>
                                    </button>
                                    {#<div id="contract-{{ contract.id }}" class="contract-delete-grey floatleft">
                                        <input type="hidden" value="{{ contract.full_address }}">
                                    </div>#}
                                </div>
                            {% endif %}
                        </td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

{{ render(controller('RjCheckoutBundle:Component:pay')) }}

<script type="text/javascript">
    $(document).ready(function() {
        var currentPaymentsViewModel = new CurrentPayments(
            {{ contractsRaw | serialize('json') | raw }},
            '{{ user.getIsVerified }}',
            {{ paidForArr | serialize('json') | raw }}
        );
        ko.applyBindings(currentPaymentsViewModel, $('#current-payments').get(0));
        {% if contractsRaw|length == 1 and contractsRaw[0].status == 'invite'%}
            $('#contract-pay-1').click();
        {% endif %}
    });
</script>

